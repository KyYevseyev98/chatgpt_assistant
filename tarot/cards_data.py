# tarot/cards_data.py
from __future__ import annotations

from dataclasses import dataclass
from typing import Dict, Optional


@dataclass(frozen=True)
class CardMeaning:
    ru_name: str
    keywords: str              # 5–12 ключевых слов через запятую
    short: str                 # 1–3 предложения “человеческим”
    shadow: Optional[str] = None  # предупреждение (1–2 предложения)
    advice: Optional[str] = None  # рекомендация (1–2 предложения)


# Ключи:
# Major Arcana:  MAJOR_00_FOOL ... MAJOR_21_WORLD
# Minor Arcana:  WANDS_01..14, CUPS_01..14, SWORDS_01..14, PENTACLES_01..14

SUIT_RU = {
    "WANDS": "жезлов",
    "CUPS": "кубков",
    "SWORDS": "мечей",
    "PENTACLES": "пентаклей",
}

RANK_RU = {
    "01": "Туз",
    "02": "Двойка",
    "03": "Тройка",
    "04": "Четвёрка",
    "05": "Пятёрка",
    "06": "Шестёрка",
    "07": "Семёрка",
    "08": "Восьмёрка",
    "09": "Девятка",
    "10": "Десятка",
    "11": "Паж",
    "12": "Рыцарь",
    "13": "Королева",
    "14": "Король",
}


def _minor_ru_name(suit: str, rank: str) -> str:
    return f"{RANK_RU[rank]} {SUIT_RU[suit]}"


# --- базовые смыслы по рангу (универсально) ---
RANK_MEANINGS = {
    "01": dict(
        keywords="новый старт, шанс, импульс, потенциал, чистая энергия",
        short="Это “первый заряд” — шанс начать с нуля и быстро сдвинуть ситуацию.",
        shadow="Риск — схватиться за идею и бросить, не доведя до результата.",
        advice="Выбери одно направление и сделай первый реальный шаг сегодня."
    ),
    "02": dict(
        keywords="выбор, баланс, союз, развилка, осторожность",
        short="Ситуация на развилке: два варианта или два полюса, которые нужно совместить.",
        shadow="Зависание и сомнения, когда решение откладывается бесконечно.",
        advice="Сформулируй критерий выбора: что для тебя важнее всего прямо сейчас?"
    ),
    "03": dict(
        keywords="рост, развитие, первые результаты, поддержка, движение",
        short="Пошёл рост. То, что ты начал(а), начинает давать первые ощутимые плоды.",
        shadow="Распыление и перегруз: много всего, но без системы.",
        advice="Усиль то, что уже работает, и убери лишнее."
    ),
    "04": dict(
        keywords="стабильность, структура, опора, границы, порядок",
        short="Нужна стабильность и чёткие рамки. Время укреплять фундамент.",
        shadow="Жёсткость, контроль, страх перемен.",
        advice="Наведи порядок: правила, режим, договорённости — и станет легче."
    ),
    "05": dict(
        keywords="кризис, конфликт, вызов, проверка, перестройка",
        short="Проверка на прочность. Конфликт или внутренний надлом — чтобы что-то поменять.",
        shadow="Обида, борьба эго, желание “победить любой ценой”.",
        advice="Не руби с плеча. Спроси: что я защищаю — ценность или гордость?"
    ),
    "06": dict(
        keywords="гармония, помощь, примирение, шаг вперёд, поддержка",
        short="Есть шанс выровнять ситуацию: найти компромисс, получить поддержку, сделать спокойный шаг.",
        shadow="Ожидание, что “само рассосётся”, без действий.",
        advice="Сделай один ясный шаг навстречу — разговор, просьба, план."
    ),
    "07": dict(
        keywords="стратегия, контроль, движение, победа, рывок",
        short="Тема управления процессом. Ты можешь взять ситуацию в руки и продвинуться.",
        shadow="Слишком жёсткий контроль или попытка тащить всё в одиночку.",
        advice="Определи маршрут и действуй по шагам, не распыляясь."
    ),
    "08": dict(
        keywords="скорость, действия, поток, новости, ускорение",
        short="События ускоряются. Много движухи, сообщений, быстрых решений.",
        shadow="Суета, импульсивность, ошибки из-за спешки.",
        advice="Действуй быстро, но проверяй факты. Фиксируй договорённости письменно."
    ),
    "09": dict(
        keywords="самостоятельность, опыт, зрелость, границы, выносливость",
        short="Ты уже многое понял(а). Важно опираться на опыт и держать границы.",
        shadow="Замыкание в себе, недоверие, усталость от людей.",
        advice="Дозируй общение и береги ресурс. Твоя сила — в спокойной дисциплине."
    ),
    "10": dict(
        keywords="итог, завершение, цикл, переход, результат",
        short="Этап подходит к итогу. Это завершение цикла и переход на новый уровень.",
        shadow="Страх завершать и держаться за старое.",
        advice="Закрой хвосты и зафиксируй результат. Потом открывай новую главу."
    ),
    "11": dict(
        keywords="ученик, сообщение, шанс, начало пути, интерес",
        short="Паж — сигнал/новость и энергия “новичка”: интерес, обучение, проба.",
        shadow="Непостоянство, поверхностность, обещания без дела.",
        advice="Тестируй маленьким шагом и собирай обратную связь."
    ),
    "12": dict(
        keywords="движение, инициативность, дорога, поступок, импульс",
        short="Рыцарь — действие и динамика. Ситуацию двигает поступок или решение.",
        shadow="Рывки без плана, конфликтность, нетерпение.",
        advice="Действуй, но держи курс. Не спорь — делай."
    ),
    "13": dict(
        keywords="зрелость, влияние, забота, глубина, внутренняя сила",
        short="Королева — зрелая энергия, глубина и умение удерживать эмоциональный/человеческий уровень.",
        shadow="Манипуляции чувствами, обида, пассивная агрессия.",
        advice="Сохрани достоинство. Говори прямо и мягко одновременно."
    ),
    "14": dict(
        keywords="контроль, ответственность, статус, лидерство, стратегия",
        short="Король — управление и ответственность. Время действовать как лидер: чётко и по делу.",
        shadow="Жёсткость, давление, желание контролировать всех.",
        advice="Будь твёрдым(ой), но справедливым(ой). Решай фактами."
    ),
}

# --- оттенок масти (добавляет смысл) ---
SUIT_FLAVOR = {
    "WANDS": dict(
        topic="энергия, мотивация, дело, драйв",
        add="Тут про огонь: желание, старт, смелость, амбиции.",
        shadow="Минус — перегореть, вспыхнуть и сдуться.",
        advice="Держи темп: меньше эмоций, больше регулярности."
    ),
    "CUPS": dict(
        topic="чувства, отношения, близость, внутреннее состояние",
        add="Тут про эмоции и связь: любовь, доверие, отклик, душу.",
        shadow="Минус — иллюзии, зависимость, обидчивость.",
        advice="Слушай чувства, но проверяй реальность поступками."
    ),
    "SWORDS": dict(
        topic="мысли, решения, конфликты, ясность, правда",
        add="Тут про ум и правду: разговоры, решения, границы, честность.",
        shadow="Минус — тревога, спор ради спора, жёсткость.",
        advice="Режь лишнее. Формулируй мысль коротко и ясно."
    ),
    "PENTACLES": dict(
        topic="деньги, работа, тело, стабильность, результат",
        add="Тут про материальное: ресурсы, безопасность, быт и результат.",
        shadow="Минус — страх потерь, жадность, застревание.",
        advice="Делай ставку на стабильные шаги и измеримые действия."
    ),
}

# --- MAJOR ARCANA (22) ---
MAJORS: Dict[str, CardMeaning] = {
    "MAJOR_00_FOOL": CardMeaning(
        ru_name="Шут",
        keywords="новый путь, риск, свобода, доверие жизни, начало",
        short="Начало с нуля и шаг в неизвестность. Это шанс обновиться и попробовать по-новому.",
        shadow="Наивность, хаос, безответственность.",
        advice="Делай шаг смело, но проверь базовые риски и держи план Б."
    ),
    "MAJOR_01_MAGICIAN": CardMeaning(
        ru_name="Маг",
        keywords="инициатива, ресурсы, влияние, мастерство, старт",
        short="У тебя уже есть инструменты, чтобы сдвинуть ситуацию. Вопрос в фокусе и действии.",
        shadow="Манипуляции, иллюзии, распыление сил.",
        advice="Собери ресурсы в одну цель и действуй быстро и чисто."
    ),
    "MAJOR_02_HIGH_PRIESTESS": CardMeaning(
        ru_name="Верховная Жрица",
        keywords="интуиция, скрытое, пауза, тайна, знание",
        short="Ответ уже внутри. Сейчас важнее наблюдать, чем давить.",
        shadow="Самообман, холодность, уход в молчание.",
        advice="Не спеши. Спроси себя: что я знаю, но не хочу признавать?"
    ),
    "MAJOR_03_EMPRESS": CardMeaning(
        ru_name="Императрица",
        keywords="рост, изобилие, забота, плодородие, комфорт",
        short="Тема роста и ресурса. Хорошо про отношения, творчество, деньги через заботу и системность.",
        shadow="Лень, излишества, зависимость от комфорта.",
        advice="Создай условия: режим, питание, быт, поддержка — и всё пойдёт."
    ),
    "MAJOR_04_EMPEROR": CardMeaning(
        ru_name="Император",
        keywords="структура, власть, ответственность, порядок, контроль",
        short="Нужны правила и опора. Это про лидерство и чёткие решения.",
        shadow="Жёсткость, давление, желание всё контролировать.",
        advice="Действуй как руководитель: по фактам, с планом, без эмоций."
    ),
    "MAJOR_05_HIEROPHANT": CardMeaning(
        ru_name="Иерофант",
        keywords="традиции, наставник, мораль, правила, обучение",
        short="Ситуация просит правильного пути: обучение, совет у эксперта, уважение к правилам.",
        shadow="Слепая вера авторитетам, догматизм.",
        advice="Возьми проверенную систему и следуй ей без самодеятельности."
    ),
    "MAJOR_06_LOVERS": CardMeaning(
        ru_name="Влюблённые",
        keywords="выбор, любовь, союз, ценности, искренность",
        short="Ключ — выбор сердцем и ценностями. Часто про отношения, но и про решение “кто я и куда”.",
        shadow="Метания, треугольники, зависимость.",
        advice="Выбирай то, где совпадают чувства и уважение к себе."
    ),
    "MAJOR_07_CHARIOT": CardMeaning(
        ru_name="Колесница",
        keywords="рывок, победа, контроль, цель, движение",
        short="Можно быстро продвинуться, если держать курс. Победа через дисциплину.",
        shadow="Конфликтность, гонка, выгорание.",
        advice="Определи цель на 7–14 дней и режь всё лишнее."
    ),
    "MAJOR_08_STRENGTH": CardMeaning(
        ru_name="Сила",
        keywords="внутренняя мощь, выдержка, мягкость, приручение",
        short="Сила не в давлении, а в спокойствии. Ты справишься через терпение и контроль эмоций.",
        shadow="Вспыльчивость, подавление, гордыня.",
        advice="Действуй мягко, но последовательно. Не спорь — удерживай позицию."
    ),
    "MAJOR_09_HERMIT": CardMeaning(
        ru_name="Отшельник",
        keywords="пауза, мудрость, одиночество, поиск смысла, опыт",
        short="Время уединиться и разобраться в себе. Ответ приходит в тишине.",
        shadow="Закрытость, изоляция, холод.",
        advice="Сократи шум: люди, инфо, соцсети — и вернётся ясность."
    ),
    "MAJOR_10_WHEEL_OF_FORTUNE": CardMeaning(
        ru_name="Колесо Фортуны",
        keywords="поворот, шанс, цикл, судьба, перемены",
        short="События меняются. Это разворот цикла и шанс попасть “в волну”.",
        shadow="Надежда на удачу без действий.",
        advice="Лови момент, но закрепляй успех системными шагами."
    ),
    "MAJOR_11_JUSTICE": CardMeaning(
        ru_name="Справедливость",
        keywords="честность, баланс, закон, последствия, ответственность",
        short="Ситуация требует честности и равновесия. Результат — по заслугам.",
        shadow="Жёсткая критика, холод, наказание.",
        advice="Действуй по правилам и фиксируй договорённости."
    ),
    "MAJOR_12_HANGED_MAN": CardMeaning(
        ru_name="Повешенный",
        keywords="пауза, переоценка, другой взгляд, отпускание, смысл",
        short="Не время давить. Важно поменять угол зрения и отпустить то, что не работает.",
        shadow="Застревание, роль жертвы, затяжная неопределённость.",
        advice="Спроси: что я удерживаю силой? Что будет, если отпустить?"
    ),
    "MAJOR_13_DEATH": CardMeaning(
        ru_name="Смерть",
        keywords="завершение, трансформация, конец этапа, перерождение",
        short="Это не про “плохо”, а про конец старого этапа. Освобождается место для нового.",
        shadow="Страх перемен, цепляние за прошлое.",
        advice="Закрой прошлое честно. Чем быстрее отпустишь — тем легче старт."
    ),
    "MAJOR_14_TEMPERANCE": CardMeaning(
        ru_name="Умеренность",
        keywords="баланс, исцеление, спокойствие, постепенность, гармония",
        short="Всё выравнивается через меру и спокойный темп. Не надо резких движений.",
        shadow="Затягивание, “ни рыба ни мясо”.",
        advice="Делай маленькие шаги каждый день — это быстрее, чем рывки."
    ),
    "MAJOR_15_DEVIL": CardMeaning(
        ru_name="Дьявол",
        keywords="искушение, зависимость, контроль, страсть, привязка",
        short="Сильная привязка: желание, деньги, человек, привычка. Тут важно увидеть, где ты теряешь свободу.",
        shadow="Зависимость, манипуляции, токсичный цикл.",
        advice="Назови честно свою зависимость и поставь ограничение/правило."
    ),
    "MAJOR_16_TOWER": CardMeaning(
        ru_name="Башня",
        keywords="слом старого, внезапность, правда, освобождение, кризис",
        short="Резкая перезагрузка. Ложные конструкции рушатся, чтобы ты начал(а) честно.",
        shadow="Шок, конфликт, разрушение из-за гордыни.",
        advice="Не держись за иллюзию. Сохрани главное и строй заново проще."
    ),
    "MAJOR_17_STAR": CardMeaning(
        ru_name="Звезда",
        keywords="надежда, вдохновение, исцеление, вера, перспектива",
        short="После напряжения приходит облегчение. Есть перспектива и “свет в конце”.",
        shadow="Мечты без действий, ожидание чуда.",
        advice="Сделай план на месяц и двигайся — мечта любит системность."
    ),
    "MAJOR_18_MOON": CardMeaning(
        ru_name="Луна",
        keywords="туман, страхи, интуиция, иллюзии, подсознание",
        short="Не всё ясно. Много эмоций, страхов или недоговорённостей.",
        shadow="Самообман, тревожность, зависимость от настроения.",
        advice="Проверяй факты. Не решай на пике эмоций — дай 24 часа."
    ),
    "MAJOR_19_SUN": CardMeaning(
        ru_name="Солнце",
        keywords="успех, радость, ясность, энергия, признание",
        short="Максимально позитивная карта: ясность, результат, радость и рост.",
        shadow="Самоуверенность, эго, “сгореть” от темпа.",
        advice="Показывайся миру. Фиксируй успех и расширяйся."
    ),
    "MAJOR_20_JUDGEMENT": CardMeaning(
        ru_name="Суд",
        keywords="пробуждение, решение, итог, призвание, перезапуск",
        short="Время решать и подниматься на новый уровень. Это про “второй шанс” и честный итог.",
        shadow="Страх ответственности, самосуд, вина.",
        advice="Закрой старое. Выбери путь и не оглядывайся."
    ),
    "MAJOR_21_WORLD": CardMeaning(
        ru_name="Мир",
        keywords="завершение, успех, целостность, новый уровень, итог",
        short="Завершение большого цикла и выход на новый уровень. Очень сильная карта результата.",
        shadow="Усталость после финиша, страх начинать новое.",
        advice="Отпразднуй результат и поставь следующую цель."
    ),
}


def _build_minors() -> Dict[str, CardMeaning]:
    out: Dict[str, CardMeaning] = {}
    for suit in ("WANDS", "CUPS", "SWORDS", "PENTACLES"):
        sf = SUIT_FLAVOR[suit]
        for rank, base in RANK_MEANINGS.items():
            key = f"{suit}_{rank}"
            ru_name = _minor_ru_name(suit, rank)

            keywords = f"{base['keywords']}, {sf['topic']}"
            short = f"{base['short']} {sf['add']}"
            shadow = f"{base['shadow']} {sf['shadow']}"
            advice = f"{base['advice']} {sf['advice']}"

            out[key] = CardMeaning(
                ru_name=ru_name,
                keywords=keywords,
                short=short,
                shadow=shadow,
                advice=advice
            )
    return out


MEANINGS: Dict[str, CardMeaning] = {}
MEANINGS.update(MAJORS)
MEANINGS.update(_build_minors())


def get_meaning(card_key: str) -> Optional[CardMeaning]:
    return MEANINGS.get(card_key)